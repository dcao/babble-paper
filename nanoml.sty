\usepackage{listings}

\lstdefinelanguage{nanoml}{
  morekeywords={fix,if,then,else,match,with,measure,data,where,termination,let,in,type},
  literate=%
    {->}{$\rightarrow$}2
    {1->}{$\xrightarrow{1}$}2
    {|}{$\mid$}2
    {:}{$\colon$}1
    {::}{$::$}2
    {/\\}{$\forall$}2
    {_\\}{$\Lambda$}2
    {\\}{$\lambda$}2
    {.}{$\ldotp$}2
    {...}{$\ldots$}2
    {!}{$\lnot$}1
    {==}{$=$}1
    {!=}{$\neq$}1
    {&&}{$\land$}1
    {||}{$\lor$}1
    {<}{$<$}1
    {>}{$>$}1
    {<=}{$\le$}1
    {>=}{$\ge$}1
    {<=set}{$\subseteq$}1
    {>=set}{$\supseteq$}1
    {+set}{$\cup$}1
    {*set}{$\cap$}1
    {<|}{<}1
    {|>}{>}1
    {_v}{$\nu$}1
    {_a}{$\alpha$}1
    {_b}{$\beta$}1
    {_c}{$\gamma$}1
    {_f}{$\phi$}1
    {u0}{$\mbox{\kappa_0}$}1
    {u1}{$\mbox{\kappa_1}$}1
    {u2}{$\mbox{\kappa_2}$}1
    {^0}{$\mbox{^0}$}1
    {^1}{$\mbox{^1}$}1
    {^2}{$\mbox{^2}$}1
    {^3}{$\mbox{^3}$}1
    {^4}{$\mbox{^4}$}1
    {^p}{$\mbox{^p}$}1
    {^q}{$\mbox{^q}$}1
    {^r}{$\mbox{^r}$}1
    {^s}{$\mbox{^s}$}1
    {^pv}{$\mbox{^{p\, \nu}}$}2
    ,
  sensitive=true,  % case sensitive
  morecomment=[l]{--},
  morestring=[b]",
  moredelim=**[is][\color{red}]{@}{@},
  numbers=none,
  firstnumber=1,
  numberstyle=\tiny,
  stepnumber=1,
  basicstyle=\scriptsize\sffamily,
  commentstyle=\itshape,
  keywordstyle=\bfseries,
  ndkeywordstyle=\bfseries,
  mathescape=true,
  columns=fullflexible,
  moredelim=**[is][\color{cyan!60!black}]{@}{@},
  moredelim=**[is][\color{green!60!black}]{~}{~},
}
\lstnewenvironment{nanoml}[1][]{%
  \lstset{language=nanoml,
    floatplacement={tbp},captionpos=b,
    xleftmargin=2pt,xrightmargin=2pt,basicstyle=\small\sffamily,#1}}{}
\newcommand{\T}[1]{\mbox{\lstinline[language=nanoml,basicstyle=\sffamily,columns=fullflexible]^#1^}}
\lstnewenvironment{nanomltbl}[1][]{%
  \lstset{language=nanoml,belowskip=-2.5ex,basicstyle=\sffamily,#1}}{}